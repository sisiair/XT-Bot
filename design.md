XT-Bot项目设计

项目架构
XT-Bot
├── 前端采集系统 (TypeScript)
│   ├── 数据获取 (fetch-following.ts/fetch-home-latest-timeline.ts)
│   ├── 用户推文获取 (fetch-tweets.ts/fetch-tweets-media.ts)
│   └── 数据存储 (.../tweets/)
└── 后端处理系统 (Python)
    ├── 数据处理引擎 (X-Bot.py)
    │   ├── 分片管理器 (ShardManager)
    │   ├── 条目处理器 (EntryProcessor)
    │   └── 核心流程控制 (XBotCore)
    ├── 数据推送引擎 (T-Bot.py)
    │   ├── 下载管理器 (DownloadManager)
    │   ├── 上传管理器 (UploadManager)
    │   └── 通知处理器 (Notifier)
    └── 初始化引擎 (INI-XT-Bot.py)
        ├── 配置加载
        └── 流程编排

流程图
1.定时自动流程 (XT-Bot.yml)
GitHub Actions 触发
    ↓
TypeScript数据获取
    ↓ (tweets/)
X-Bot.py处理
    ↓ (output/*.json)
T-Bot.py推送
    ↓
Telegram Bot/飞书机器人

2.手动初始化流程 (INI-XT-Bot.yml)
手动触发/配置新用户
    ↓
读取配置文件(config.json)
    ↓
获取历史推文(fetch-tweets-media.ts)
    ↓
初始化处理(INI-XT-Bot.py)
    ↓
调用X-Bot.py处理数据
    ↓
触发T-Bot.py推送

T-Bot.py主流程
main()
  ↓
batch_process()/process_single()
  ↓
FileProcessor.load_data()
  ↓
DownloadManager.process_item()
  ↓
UploadManager.process_item()
  ↓ 
FileProcessor.save_data()

# XT-Bot架构设计图

## 1. 整体系统架构

```
+-------------------------+    +------------------------+
|     GitHub Actions      |    |     定时/手动触发      |
+-------------------------+    +------------------------+
            |                              |
            v                              v
+--------------------------+    +--------------------------+
|    TypeScript子系统      |    |      Python子系统        |
|                          |    |                          |
| +----------------------+ |    | +--------------------+   |
| | 数据获取模块         | |    | | X-Bot.py           |   |
| | - fetch-following    | |    | | - 分片管理器       |   |
| | - fetch-timeline     | |    | | - 条目处理器       |   |
| | - fetch-tweets       | |    | | - 核心流程控制     |   |
| +----------------------+ |    | +--------------------+   |
|           |              |    |           |              |
|           v              |    |           v              |
| +----------------------+ |    | +--------------------+   |
| | 数据存储             | |    | | T-Bot.py           |   |
| | - tweets目录         |------->| - 下载管理器       |   |
| +----------------------+ |    | | - 上传管理器       |   |
|                          |    | | - 通知处理器       |   |
+--------------------------+    | +--------------------+   |
            ^                   |           |              |
            |                   | +--------------------+   |
+-------------------------+     | | INI-XT-Bot.py      |   |
|      Twitter API        |     | | - 配置加载         |   |
+-------------------------+     | | - 流程编排         |   |
                                | +--------------------+   |
                                +--------------------------+
                                            |
                                  +---------+---------+
                                  |                   |
                                  v                   v
                      +---------------------+ +-------------------+
                      |    Telegram Bot     | |    飞书机器人     |
                      +---------------------+ +-------------------+
```

## 2. 数据流转图

```
+-------------+    +----------------+    +----------------+    +----------------+
| Twitter API |--->| 原始推文数据   |--->| 结构化媒体数据 |--->| 媒体文件下载  |
+-------------+    | *.json         |    | YYYY-MM-DD.json|    | downloads目录 |
                   +----------------+    +----------------+    +----------------+
                         ^                      ^                    |
                         |                      |                    v
                   +----------------+    +----------------+    +----------------+
                   | fetch-*.ts     |    | X-Bot.py       |    | T-Bot.py      |
                   | TypeScript模块 |    | 数据处理引擎   |    | 推送引擎      |
                   +----------------+    +----------------+    +----------------+
                                                                      |
                                                                      v
                                                            +-------------------+
                                                            | Telegram/飞书推送 |
                                                            +-------------------+
```

## 3. 处理流程图

### 自动同步流程 (XT-Bot.yml)

```
+----------------+    +------------------+    +----------------+    +----------------+
| 定时触发       |--->| fetch-following  |--->| fetch-timeline |--->| X-Bot.py      |
| 每30分钟       |    | 获取关注用户     |    | 获取时间线     |    | 处理数据      |
+----------------+    +------------------+    +----------------+    +----------------+
                                                                          |
                                                                          v
                                                                    +----------------+
                                                                    | T-Bot.py       |
                                                                    | 推送媒体      |
                                                                    +----------------+
```

### 手动初始化流程 (INI-XT-Bot.yml)

```
+----------------+    +------------------+    +----------------+    +----------------+
| 手动触发       |--->| 加载config.json  |--->| fetch-tweets   |--->| INI-XT-Bot.py |
| 新增用户时     |    | 用户列表         |    | 获取用户推文   |    | 编排处理流程  |
+----------------+    +------------------+    +----------------+    +----------------+
                                                                          |
                      +----------------+                                  |
                      | T-Bot.py       |<---------------------------------+
                      | 推送媒体      |
                      +----------------+
```

## 4. 模块组织图

### T-Bot.py 组件结构

```
+-------------------+
|      Config       |
| 全局配置类        |
+-------------------+
          |
  +-------+--------+
  |                |
  v                v
+------------+  +------------+
| Notifier   |  | 异常类     |
| 通知处理器 |  | 自定义异常 |
+------------+  +------------+
                      ^
+------------+        |
| 日志配置   |        |
+------------+        |
      |               |
      v               |
+------------+  +------------+  +------------+
| 文件处理   |  | 下载管理器 |  | 上传管理器 |
| 加载/保存  |->| 下载媒体   |->| 推送媒体   |
+------------+  +------------+  +------------+
      ^                              |
      |                              v
+------------+                 +------------+
| 主流程控制 |<----------------| Telegram   |
| 批量/单个  |                 | 发送消息   |
+------------+                 +------------+
```

### X-Bot.py 组件结构

```
+-------------------+
|      Config       |
| 全局配置类        |
+-------------------+
          |
  +-------+--------+
  |                |
  v                v
+------------+  +------------+
| 日志配置   |  | 分片管理器 |
+------------+  | 记录处理   |
      |         +------------+
      v               ^
+------------+        |
| XBotCore   |        |
| 核心控制器 |--------+
+------------+        |
      |               |
      v               v
+------------+  +------------+
| FileManager|  | EntryProc  |
| 文件操作   |  | 条目处理器 |
+------------+  +------------+
```

### INI-XT-Bot.py 组件结构

```
+-------------------+
|    配置模块       |
| 环境/路径/消息    |
+-------------------+
          |
  +-------+--------+
  |                |
  v                v
+------------+  +------------+
| 日志配置   |  | 通知模块   |
+------------+  | 消息发送   |
      |         +------------+
      v               ^
+------------+        |
| 核心逻辑   |        |
| 流程编排   |--------+
+------------+        |
      |               |
      v               v
+------------+  +------------+
| 配置加载   |  | 子流程调用 |
| 用户列表   |  | X/T-Bot    |
+------------+  +------------+
```

## 5. 调用链路图

```
GitHub Actions
    |
    v
+-------------------+
| XT-Bot.yml        |<----+
| 定时自动执行      |     |
+-------------------+     |
    |                     |
    v                     |
+-------------------+     |
| TypeScript前端    |     |
| 数据抓取          |     |
+-------------------+     |
    |                     |
    v                     |
+-------------------+     |
| X-Bot.py          |     |
| 数据处理          |     |
+-------------------+     |
    |                     |
    v                     |
+-------------------+     |
| T-Bot.py          |     |
| 媒体推送          |     |
+-------------------+     |
                          |
+-------------------+     |
| INI-XT-Bot.yml    |     |
| 手动初始化        |-----+
+-------------------+
    |
    v
+-------------------+
| INI-XT-Bot.py     |
| 初始化处理        |
+-------------------+
```